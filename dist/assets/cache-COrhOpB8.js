const l="religious_guidance_cache";function p(t,a){const e=t.toLowerCase().split(/\s+/),n=a.toLowerCase().split(/\s+/),i=new Set(e),r=new Set(n),s=new Set([...i].filter(o=>r.has(o))),u=new Set([...i,...r]);return s.size/u.size}function m(t){if(!t.quotes||t.quotes.length<2)return!1;const a=t.quotes.map(r=>r.source);if(new Set(a).size/a.length<.4)return!0;const n=["Bhagavad Gita 2:48","Bhagavad Gita 2:47","Bhagavad Gita 3:35","Bhagavad Gita 4:7","Bhagavad Gita 4:8","Bhagavad Gita 9:27","Bhagavad Gita 18:66","John 3:16","Psalm 23","Matthew 6:33","Matthew 11:28","Philippians 4:13","Jeremiah 29:11","Quran 1:1","Quran 2:255","Quran 2:286","Quran 55:1","Quran 112:1","Guru Granth Sahib 1:1","Guru Granth Sahib 62:3","Guru Granth Sahib 1:2","Rigveda 1:1:1","Atharvaveda 10:8:44"];return a.filter(r=>n.some(s=>r.includes(s))).length/a.length>.4}function c(){try{const t=localStorage.getItem(l);return t?JSON.parse(t):[]}catch(t){return console.warn("Error reading from cache:",t),[]}}function g(t){try{const a=t.sort((e,n)=>n.timestamp-e.timestamp).slice(0,50);localStorage.setItem(l,JSON.stringify(a))}catch(a){console.warn("Error saving to cache:",a)}}function E(t,a,e=.7){const n=c(),i=Date.now(),r=n.filter(o=>i-o.timestamp<864e5);r.length!==n.length&&g(r);let s=null,u=0;for(const o of r)if(o.selectedText===t){const h=p(o.userMessage,a);h>e&&h>u&&(m(o.response)||(u=h,s=o))}return s?s.response:null}function d(t,a,e){if(m(e))return;const n=c();n.push({selectedText:t,userMessage:a,response:e,timestamp:Date.now()}),g(n)}function w(){try{localStorage.removeItem(l)}catch(t){console.warn("Error clearing cache:",t)}}function C(){const t=c(),a=Date.now();return t.filter(e=>a-e.timestamp<864e5).sort((e,n)=>n.timestamp-e.timestamp).map(e=>({...e,formattedTime:new Date(e.timestamp).toLocaleString(),timeAgo:f(e.timestamp),isExpired:!1}))}function S(){const t=c(),a=Date.now();return t.filter(e=>a-e.timestamp>=864e5).sort((e,n)=>n.timestamp-e.timestamp).map(e=>({...e,formattedTime:new Date(e.timestamp).toLocaleString(),timeAgo:f(e.timestamp),isExpired:!0}))}function f(t){const e=Date.now()-t,n=Math.floor(e/(1e3*60)),i=Math.floor(e/(1e3*60*60)),r=Math.floor(e/(1e3*60*60*24));return r>0?`${r} day${r>1?"s":""} ago`:i>0?`${i} hour${i>1?"s":""} ago`:n>0?`${n} minute${n>1?"s":""} ago`:"Just now"}function v(){const t=c(),a=Date.now(),e=t.filter(i=>a-i.timestamp<864e5),n=t.filter(i=>a-i.timestamp>=864e5);return{totalEntries:t.length,validEntries:e.length,expiredEntries:n.length,oldestEntry:t.length>0?new Date(Math.min(...t.map(i=>i.timestamp))):null,newestEntry:t.length>0?new Date(Math.max(...t.map(i=>i.timestamp))):null,cacheSize:JSON.stringify(t).length}}export{d as cacheResponse,w as clearCache,E as findCachedResponse,C as getAllCacheEntries,v as getCacheStats,S as getExpiredCacheEntries};
